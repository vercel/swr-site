import { Callout } from 'nextra-theme-docs'

# Next.js ã§ã®åˆ©ç”¨

## App Router [#app-dir]

### Server Components [#rsc]

<Callout type="default" emoji="âœ…">
   In Next.js App Router, all components are React Server Components (RSC) by default. **You could only import the key serialization APIs from SWR in RSC.**
</Callout>

```tsx filename="app/page.tsx" copy
import { unstable_serialize } from 'swr' // âœ… works 
import { unstable_serialize as infinite_unstable_serialize } from 'swr/infinite' // âœ… works 
```


<Callout type="error">
   You could not import any other APIs from SWR since they are not available in RSC.
</Callout>

```tsx filename="app/page.tsx" highlight={1}
import useSWR from 'swr' // âŒ it will throw an error
```

### Client Components

You need to mark your components with `'use client'` directive so that SWR could work properly.

```tsx filename="app/page.tsx" highlight={1} copy
'use client'
import useSWR from 'swr'
export default Page() {
  const { data } = useSWR('/api/user', fetcher)
  return <h1>{data.name}</h1>
}
```

If you need to use `SWRConfig` to do some global setup in your `layout` or `page` component, but you also don't want to make them as client components. You could create a separate provider component

```tsx filename="app/swr-provider.tsx" copy
'use client';
import { SWRConfig } from 'swr'
export const SWRProvider = ({ children }) => {
  return <SWRConfig>{children}</SWRConfig>
};
```

```tsx filename="app/page.tsx" copy
// This is still a server component
import { SWRProvider } from './swr-provider'
export default Page() {
  return (
    <SWRProvider>
      <h1>hello SWR</h1>
    </SWRProvider>
  )
}
```

## ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ [#client-side-data-fetching]

ãƒšãƒ¼ã‚¸ã«é »ç¹ã«æ›´æ–°ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã€ãƒ‡ãƒ¼ã‚¿ã‚’äº‹å‰ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒãªã„å ´åˆã€ SWR ã¯ç‰¹åˆ¥ãªè¨­å®šãŒå¿…è¦ãªã„ã»ã©ãƒ”ãƒƒã‚¿ãƒªã§ã™ï¼š
`useSWR` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã ã‘ã§ã™ã€‚

æ–¹æ³•ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

- ã¾ãšã€ãƒ‡ãƒ¼ã‚¿ã®ãªã„ãƒšãƒ¼ã‚¸ã‚’ã™ãã«è¡¨ç¤ºã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãŒãªã„ã¨ãã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
- ç¶šã„ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€æº–å‚™ãŒã§ããŸã‚‰è¡¨ç¤ºã—ã¾ã™ã€‚

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€ãŸã¨ãˆã°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ãªã©ã§æœ‰åŠ¹ã§ã™ã€‚ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å°‚ç”¨ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªãƒšãƒ¼ã‚¸ã§ã‚ã‚‹ãŸã‚ SEO ã¯é–¢ä¿‚ãªãã€
ãƒšãƒ¼ã‚¸ã‚’äº‹å‰ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹å¿…è¦ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ã¯é »ç¹ã«æ›´æ–°ã•ã‚Œã‚‹ãŸã‚ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ãƒ‡ãƒ¼ã‚¿å–å¾—å‡¦ç†ãŒå¿…è¦ã§ã™ã€‚

## ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ãƒ¼ã‚¿ã§äº‹å‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° [#pre-rendering-with-default-data]

ã‚‚ã—ãƒšãƒ¼ã‚¸ã‚’äº‹å‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã€ Next.js ã¯äºŒã¤ã®å½¢å¼ã®äº‹å‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®æ–¹æ³•ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š
**Static Generation (SSG)** ã¨ **Server-side Rendering (SSR)** ã€‚

SWR ã¨ä¸€ç·’ã«ä½¿ãˆã°ã€SEO ç”¨ã«ãƒšãƒ¼ã‚¸ã‚’äº‹å‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸã‚Šã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€å†æ¤œè¨¼ã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã€å®šæœŸçš„ãªå†å–å¾—ãªã©ã®æ©Ÿèƒ½ã‚’å®Ÿè¡Œã™ã‚‹äº‹ãŒã§ãã¾ã™ã€‚

[`SWRConfig`](/docs/global-configuration) ã® `fallback` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ã¨ã€äº‹å‰ã«å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦ã® SWR ãƒ•ãƒƒã‚¯ã®åˆæœŸå€¤ã¨ã—ã¦æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
ãŸã¨ãˆã°ã€ `getStaticProps` ã®å ´åˆï¼š

```jsx
 export async function getStaticProps () {
  // `getStaticProps` ã¯ã‚µãƒ¼ãƒãƒ¼å´ã§å®Ÿè¡Œã•ã‚Œã¾ã™
  const article = await getArticleFromAPI()
  return {
    props: {
      fallback: {
        '/api/article': article
      }
    }
  }
}

function Article() {
  // `data` ã¯ `fallback` ã‚’åˆ©ç”¨ã—ã¦å¸¸ã«åˆ©ç”¨å¯èƒ½ã§ã™ã€‚
  const { data } = useSWR('/api/article', fetcher)
  return <h1>{data.title}</h1>
}

export default function Page({ fallback }) {
  // `SWRConfig` ã®ç¯„å›²å†…ã® SWR ãƒ•ãƒƒã‚¯ã¯ã€è¨­å®šã®å€¤ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
  return (
    <SWRConfig value={{ fallback }}>
      <Article />
    </SWRConfig>
  )
}
```

ãƒšãƒ¼ã‚¸ã¯ã¾ã äº‹å‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ã¾ã™ã€‚ SEO ã«å¯¾å¿œã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒé€Ÿã„ã ã‘ã§ãªãã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã® SWR ã«ã‚ˆã£ã¦å®Œå…¨ã«æ©Ÿèƒ½ã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã¯å‹•çš„ã§ã‚ã‚Šã€æ™‚é–“ã®çµŒéã¨ã¨ã‚‚ã«è‡ªå·±æ›´æ–°ã•ã‚Œã¾ã™ã€‚

<Callout emoji="ğŸ’¡">
  `Article` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€äº‹å‰ã«ç”Ÿæˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’æœ€åˆã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã€ãƒšãƒ¼ã‚¸ãŒãƒã‚¤ãƒ‰ãƒ¬ã‚¤ãƒˆã•ã‚ŒãŸå¾Œã€æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã—ã¦æ›´æ–°ã‚’ç¶­æŒã—ã¾ã™ã€‚
</Callout>

### è¤‡é›‘ãªã‚­ãƒ¼ [#complex-keys]

`useSWR` ã¯ `array` ã¨ `function` å‹ã®ã‚­ãƒ¼ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚­ãƒ¼ã§ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ `fallback` ã‚­ãƒ¼ã‚’ `unstable_serialize` ã§ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```jsx
import useSWR, { unstable_serialize } from 'swr'

export async function getStaticProps () {
  const article = await getArticleFromAPI(1)
  return {
    props: {
      fallback: {
        // unstable_serialize() ã« array å½¢å¼ã®ã‚­ãƒ¼ã‚’æ¸¡ã™
        [unstable_serialize(['api', 'article', 1])]: article,
      }
    }
  }
}

function Article() {
  // array å½¢å¼ã®ã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
  const { data } = useSWR(['api', 'article', 1], fetcher)
  return <h1>{data.title}</h1>
}

export default function Page({ fallback }) {
  return (
    <SWRConfig value={{ fallback }}>
      <Article />
    </SWRConfig>
  )
}
```
