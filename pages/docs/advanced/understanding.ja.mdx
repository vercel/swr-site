import Callout from 'nextra-theme-docs/callout'
import Video from 'components/video'

# SWR ã‚’ç†è§£ã™ã‚‹

## çŠ¶æ…‹æ©Ÿæ¢°

`useSWR` ã¯ `data`ã€`error`ã€`isLoading` ã¨ `isValidating` ã‚’ `fetcher` é–¢æ•°ã®çŠ¶æ…‹ã«å¿œã˜ã¦è¿”ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®å›³ã¯ SWR ãŒãã‚Œãã‚Œã§ã©ã®ã‚ˆã†ã«å€¤ã‚’è¿”ã™ã®ã‹ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

### ãƒ•ã‚§ãƒƒãƒã—ã¦å†æ¤œè¨¼ã™ã‚‹

ã“ã‚Œã¯ãƒ•ã‚§ãƒƒãƒã—ã¦å†æ¤œè¨¼ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

![ãƒ•ã‚§ãƒƒãƒã¨å†æ¤œè¨¼ã®ãƒ‘ã‚¿ãƒ¼ãƒ³](/img/understanding/fetch-and-revalidate.svg)

### ã‚­ãƒ¼ã®å¤‰æ›´

ã“ã‚Œã¯ãƒ•ã‚§ãƒƒãƒã—ãŸå¾Œã«ã‚­ãƒ¼ã‚’å¤‰æ›´ã—ã€ã•ã‚‰ã«ãã®å¾Œå†æ¤œè¨¼ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

![ã‚­ãƒ¼ãŒå¤‰æ›´ã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³](/img/understanding/key-change.svg)

### ã‚­ãƒ¼ã®å¤‰æ›´ã¨ä»¥å‰ã®ãƒ‡ãƒ¼ã‚¿

ã“ã‚Œã¯ãƒ•ã‚§ãƒƒãƒã—ãŸå¾Œã«ã‚­ãƒ¼ã‚’å¤‰æ›´ã—å†æ¤œè¨¼ã™ã‚‹ã®ã‚’ `keepPreviousData` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ãã§è¡Œã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

![ã‚­ãƒ¼ã®å¤‰æ›´ã‚’ keepPreviousData ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚ã‚Šã§è¡Œã†ãƒ‘ã‚¿ãƒ¼ãƒ³](/img/understanding/key-change-previous-data.svg)

### ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

ã“ã‚Œã¯ãƒ•ã‚§ãƒƒãƒã—ãŸå¾Œã«å†æ¤œè¨¼ã™ã‚‹ã®ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã¨ä¸€ç·’ã«è¡Œã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

![ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ãƒ‘ã‚¿ãƒ¼ãƒ³](/img/understanding/fallback.svg)

### ã‚­ãƒ¼ã®å¤‰æ›´ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

ã“ã‚Œã¯ãƒ•ã‚§ãƒƒãƒã—ãŸå¾Œã«ã‚­ãƒ¼ã‚’å¤‰æ›´ã—å†æ¤œè¨¼ã™ã‚‹ã®ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã¨ä¸€ç·’ã«è¡Œã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

![ã‚­ãƒ¼ã®å¤‰æ›´ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚ã‚Šã§è¡Œã†ãƒ‘ã‚¿ãƒ¼ãƒ³](/img/understanding/key-change-fallback.svg)

### ã‚­ãƒ¼ã®å¤‰æ›´ã¨ä»¥å‰ã®ãƒ‡ãƒ¼ã‚¿ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

ã“ã‚Œã¯ãƒ•ã‚§ãƒƒãƒã—ãŸå¾Œã«ã‚­ãƒ¼ã‚’å¤‰æ›´ã—å†æ¤œè¨¼ã™ã‚‹ã®ã‚’ `keepPreviousData` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã¨ä¸€ç·’ã«è¡Œã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

![ã‚­ãƒ¼ã®å¤‰æ›´ã‚’ keepPreviousData ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚ã‚Šã§è¡Œã†ãƒ‘ã‚¿ãƒ¼ãƒ³](/img/understanding/key-change-previous-data-fallback.svg)

## Combining with isLoading and isValidating for better UX

Comparing to the existing `isValidating` value, `isLoading` is a new property that can help you for the more general loading cases for UX.

- `isValidating` becomes `true` whenever there is an ongoing request **whatever the the data is loaded or not**
- `isLoading` becomes `true` when there is an ongoing request and **data is not loaded yet**.

Simply saying you can use `isValidating` for indicating everytime there is an ongoing revalidation, and `isLoading` for indicating that SWR is revalidating but there is no data yet to display.

<Callout emoji="ğŸ“">
  Fallback data and previous data are not considered "loaded data," so when you use fallback data or enable the keepPreviousData option, you might have data to display.
</Callout>

```jsx
function Stock() {
  const { data, isLoading, isValidating } = useSWR(STOCK_API, fetcher, {
    refreshInterval: 3000
  });

  // If it's still loading the initial data, there is nothing to display.
  // We return a skeleton here.
  if (isLoading) return <div className="skeleton" />;

  // Otherwise, display the data and a spinner that indicates a background
  // revalidation.
  return (
    <>
      <div>${data}</div>
      {isValidating ? <div className="spinner" /> : null}
    </>
  );
}
```

![An example of using the isLoading state](/img/understanding/isloading.gif)

You can find the code example [here](https://codesandbox.io/s/swr-isloading-jtopow)

## ã‚ˆã‚Šã‚ˆã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®ãŸã‚ã«ä»¥å‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™

ã‚­ãƒ¼å…¥åŠ›ã«å¿œã˜ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢ãªã©ç¶™ç¶šçš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’è¡Œã†æ™‚ã€ä»¥å‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¶­æŒã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æ”¹å–„ã§ãã¾ã™ã€‚`keepPreviousData` ã¯ã“ã‚Œã‚’å¯èƒ½ã«ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã€‚ã“ã‚Œã¯ã‚·ãƒ³ãƒ—ãƒ«ãªæ¤œç´¢ã®ä¾‹ã§ã™ã€‚

```jsx
function Search() {
  const [search, setSearch] = React.useState('');

  const { data, isLoading } = useSWR(`/search?q=${search}`, fetcher, {
    keepPreviousData: true
  });

  return (
    <div>
      <input
        type="text"
        value={search}
        onChange={(e) => setSearch(e.target.value)}
        placeholder="Search..."
      />

      <div className={isLoading ? "loading" : ""}>
        {data?.products.map(item => <Product key={item.id} name={item.name} />)
      </div>
    </div>
  );
}
```

`keepPreviousData` ãŒæœ‰åŠ¹ã«ã•ã‚Œã¦ã„ã‚‹å ´åˆã€SWR ã®ã‚­ãƒ¼ãŒå¤‰ã‚ã‚Šæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãŒé–‹å§‹ã•ã‚ŒãŸå ´åˆã«ã‚‚ä»¥å‰ã®ã‚­ãƒ¼ã«å¯¾å¿œã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒè¿”ã•ã‚Œã¾ã™ã€‚

<Video
  src="https://user-images.githubusercontent.com/3676859/163695903-a3eb1259-180e-41e0-821e-21c320201194.mp4"
  caption="keepPreviousData ãŒæœ‰åŠ¹ãªå ´åˆã«ã¯ä»¥å‰ã®æ¤œç´¢çµæœãŒç¶­æŒã•ã‚Œã¾ã™"
  ratio={640/730}
/>

ã“ã®ä¾‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰ã§ã™: https://codesandbox.io/s/swr-keeppreviousdata-fsjz3m.

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã®ãŸã‚ã®ä¾å­˜åé›†

SWR ã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚ŒãŸå ´åˆã®ã¿å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸­ã§ `data` ã—ã‹ä½¿ã£ã¦ã„ãªã„å ´åˆã€SWR ã¯ `isValidating` ã‚„ `isLoading` ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æ›´æ–°ã‚’ç„¡è¦–ã—ã¾ã™ã€‚ã“ã‚Œã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®å›æ•°ã‚’æ¸›ã‚‰ã—ã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ [ã“ã¡ã‚‰](/docs/advanced/performance#dependency-collection)ã€‚
