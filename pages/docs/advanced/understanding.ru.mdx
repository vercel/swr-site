import { Callout } from 'nextra-theme-docs'
import Video from 'components/video'

# –ü–æ–Ω–∏–º–∞–Ω–∏–µ SWR

## –ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è (State Machine) [#state-machine]

`useSWR` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `data`, `error`, `isLoading` –∏ `isValidating` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ `fetcher`. –ù–∞ —ç—Ç–∏—Ö –¥–∏–∞–≥—Ä–∞–º–º–∞—Ö –ø–æ–∫–∞–∑–∞–Ω–æ, –∫–∞–∫ SWR –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.

### –í—ã–±–æ—Ä–∫–∞ –∏ –†–µ–≤–∞–ª–∏–¥–∞—Ü–∏—è [#fetch-and-revalidate]

–≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Ö –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏–∏.

![–®–∞–±–ª–æ–Ω –≤—ã–±–æ—Ä–∫–∏ –∏ —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏–∏](/img/understanding/fetch-and-revalidate.svg)

### –°–º–µ–Ω–∞ –∫–ª—é—á–∞ [#key-change]

–≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–ª—é—á–∞ –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏–∏.

![–®–∞–±–ª–æ–Ω —Å–º–µ–Ω—ã –∫–ª—é—á–∞](/img/understanding/key-change.svg)

### –°–º–µ–Ω–∞ –∫–ª—é—á–∞ + –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ [#key-change--previous-data]

–≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–º–µ–Ω—ã –∫–ª—é—á–∞ –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `keepPreviousData`.

![–®–∞–±–ª–æ–Ω –°–º–µ–Ω—ã –∫–ª—é—á–∞ + –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ](/img/understanding/key-change-previous-data.svg)

### –†–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (Fallback) [#fallback]

–≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

![–®–∞–±–ª–æ–Ω —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏](/img/understanding/fallback.svg)

### –°–º–µ–Ω–∞ –∫–ª—é—á–∞ + –†–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ [#key-change--fallback]

–≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö, —Å–º–µ–Ω—ã –∫–ª—é—á–∞ –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

![–®–∞–±–ª–æ–Ω –°–º–µ–Ω—ã –∫–ª—é—á–∞ + –†–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ](/img/understanding/key-change-fallback.svg)

### –°–º–µ–Ω–∞ –∫–ª—é—á–∞ + –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ + –†–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ [#key-change--previous-data--fallback]

–≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö, —Å–º–µ–Ω—ã –∫–ª—é—á–∞ –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `keepPreviousData` –∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

![–®–∞–±–ª–æ–Ω —Å–º–µ–Ω—ã –∫–ª—é—á–∞ + –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö + —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö](/img/understanding/key-change-previous-data-fallback.svg)

## –°–æ—á–µ—Ç–∞–Ω–∏–µ isLoading –∏ isValidating –¥–ª—è –ª—É—á—à–µ–≥–æ UX [#combining-with-isloading-and-isvalidating-for-better-ux]

–ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º `isValidating`, `isLoading` ‚Äî —ç—Ç–æ –Ω–æ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –≤–∞–º –≤ –±–æ–ª–µ–µ –æ–±—â–∏—Ö —Å–ª—É—á–∞—è—Ö –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è UX.

- `isValidating` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `true` –≤—Å—è–∫–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –µ—Å—Ç—å —Ç–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –Ω–µ—Ç**
- `isLoading` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `true`, –∫–æ–≥–¥–∞ –µ—Å—Ç—å —Ç–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å –∏ **–¥–∞–Ω–Ω—ã–µ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã**.

–ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `isValidating` –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏—è, –∏ `isLoading` –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è, —á—Ç–æ SWR –ø—Ä–æ–≤–æ–¥–∏—Ç —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏—é, –Ω–æ –ø–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.

<Callout emoji="üìù">
  –†–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è ¬´–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏¬ª, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ keepPreviousData —É –≤–∞—Å –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.
</Callout>

```jsx
function Stock() {
  const { data, isLoading, isValidating } = useSWR(STOCK_API, fetcher, {
    refreshInterval: 3000
  });

  // –ï—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤—Å—ë –µ—â—ë –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è, –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –Ω–µ—á–µ–≥–æ.
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—é–¥–∞ —Å–∫–µ–ª–µ—Ç–æ–Ω.
  if (isLoading) return <div className="skeleton" />;

  // –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ —Å–ø–∏–Ω–Ω–µ—Ä,
  // —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ —Ñ–æ–Ω–æ–≤—É—é —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏—é.
  return (
    <>
      <div>${data}</div>
      {isValidating ? <div className="spinner" /> : null}
    </>
  );
}
```

![–ü—Ä–∏–º–µ—Ä —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è isLoading](/img/understanding/isloading.gif)

–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞ [–∑–¥–µ—Å—å](https://codesandbox.io/s/swr-isloading-jtopow)

## –í–æ–∑–≤—Ä–∞—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª—É—á—à–µ–≥–æ UX [#return-previous-data-for-better-ux]

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø–æ–∏—Å–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –ø—Ä–∏ –Ω–∞–±–æ—Ä–µ —Ç–µ–∫—Å—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–Ω–µ–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç—å UX. `keepPreviousData` ‚Äî —ç—Ç–æ –æ–ø—Ü–∏—è, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –≤–∫–ª—é—á–∏—Ç—å —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ. –í–æ—Ç –ø—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∏—Å–∫–∞:

```jsx
function Search() {
  const [search, setSearch] = React.useState('');

  const { data, isLoading } = useSWR(`/search?q=${search}`, fetcher, {
    keepPreviousData: true
  });

  return (
    <div>
      <input
        type="text"
        value={search}
        onChange={(e) => setSearch(e.target.value)}
        placeholder="–ü–æ–∏—Å–∫..."
      />

      <div className={isLoading ? "–∑–∞–≥—Ä—É–∑–∫–∞" : ""}>
        {data?.products.map(item => <Product key={item.id} name={item.name} />)
      </div>
    </div>
  );
}
```

–° –≤–∫–ª—é—á–µ–Ω–Ω—ã–º `keepPreviousData` –≤—ã –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏—Ç–µ –∫–ª—é—á SWR, –∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–ª—é—á–∞ —Å–Ω–æ–≤–∞ –Ω–∞—á–Ω—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è.

<Video
  src="https://user-images.githubusercontent.com/3676859/163695903-a3eb1259-180e-41e0-821e-21c320201194.mp4"
  caption="–°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä keepPreviousData"
  ratio={640/730}
/>

–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –ø–æ–ª–Ω—ã–π –∫–æ–¥ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –∑–¥–µ—Å—å: https://codesandbox.io/s/swr-keeppreviousdata-fsjz3m.

## –ö–æ–ª–ª–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ [#dependency-collection-for-performance]

SWR –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ, –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã. –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–æ–ª—å–∫–æ `data` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ, SWR –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö —Å–≤–æ–π—Å—Ç–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ `isValidating` –∏ `isLoading`. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ [–∑–¥–µ—Å—å](/docs/advanced/performance#dependency-collection).
