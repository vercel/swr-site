import { Callout } from 'nextra-theme-docs'
import Video from 'components/video'

# SWR ì´í•´í•˜ê¸°

## ìƒíƒœ ë¨¸ì‹  [#state-machine]

`useSWR`ì€ `fetcher` í•¨ìˆ˜ì— ë”°ë¼ `data`, `error`, `isLoading` ê·¸ë¦¬ê³  `isValidating`ì„ ë°˜í™˜í•©ë‹ˆë‹¤. ì´ ë‹¤ì´ì–´ê·¸ë¨ì€ ì¼ë¶€ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ SWRì´ ê°’ì„ ë°˜í™˜í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

### ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë° ì¬ê²€ì¦ [#fetch-and-revalidate]

ì´ íŒ¨í„´ì€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ ë‚˜ì¤‘ì— ë‹¤ì‹œ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

![A pattern for fetch and revalidate](/img/understanding/fetch-and-revalidate.svg)

### í‚¤ ë³€ê²½ [#key-change]

This pattern is to fetch data and change the key and revalidate it later.
ì´ íŒ¨í„´ì€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ í‚¤ë¥¼ ë³€ê²½í•˜ê³  ë‚˜ì¤‘ì— ë‹¤ì‹œ ê²€ì¦(revalidate)í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

![A pattern for key change](/img/understanding/key-change.svg)

### í‚¤ ë³€ê²½ + ì´ì „ ë°ì´í„° [#key-change--previous-data]

ì´ íŒ¨í„´ì€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ í‚¤ë¥¼ ë³€ê²½í•˜ê³ , `keepPreviousData` ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ê¸°ì¡´ ë°ì´í„°ë¥¼ ìœ ì§€í•œ ì±„ ë‚˜ì¤‘ì— ë‹¤ì‹œ ê²€ì¦í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

![A pattern for key change + previous data](/img/understanding/key-change-previous-data.svg)

### í´ë°± [#fallback]

ì´ íŒ¨í„´ì€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„, í´ë°± ë°ì´í„°(fallback data)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚˜ì¤‘ì— ë‹¤ì‹œ ê²€ì¦í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

![A pattern for fallback](/img/understanding/fallback.svg)

### í‚¤ ë³€ê²½ + í´ë°± [#key-change--fallback]

ì´ íŒ¨í„´ì€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ í‚¤ë¥¼ ë³€ê²½í•˜ê³ , í´ë°± ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚˜ì¤‘ì— ë‹¤ì‹œ ê²€ì¦í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

![A pattern for key change + fallback](/img/understanding/key-change-fallback.svg)

### í‚¤ ë³€ê²½ + ì´ì „ ë°ì´í„° + í´ë°± [#key-change--previous-data--fallback]

ì´ íŒ¨í„´ì€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ í‚¤ë¥¼ ë³€ê²½í•˜ê³ , `keepPreviousData` ì˜µì…˜ê³¼ í´ë°± ë°ì´í„°ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬ ë‚˜ì¤‘ì— ë‹¤ì‹œ ê²€ì¦í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

![A pattern for key change + previous data + fallback](/img/understanding/key-change-previous-data-fallback.svg)

## isLoading ë° isValidatingì„ í™œìš©í•œ UX ê°œì„  [#combining-with-isloading-and-isvalidating-for-better-ux]

Comparing to the existing `isValidating` value, `isLoading` is a new property that can help you for the more general loading cases for UX.
ê¸°ì¡´ì˜ `isValidating` ê°’ê³¼ ë¹„êµí–ˆì„ ë•Œ, `isLoading`ì€ ë³´ë‹¤ ì¼ë°˜ì ì¸ ë¡œë”© ìƒíƒœë¥¼ ë‹¤ë£¨ëŠ” ìƒˆë¡œìš´ ì†ì„±ì…ë‹ˆë‹¤.

- `isValidating`ì€ **ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´** ìš”ì²­ì´ ì§„í–‰ ì¤‘ì´ë©´ í•­ìƒ trueê°€ ë©ë‹ˆë‹¤.
- `isLoading`ì€ ìš”ì²­ì´ ì§„í–‰ ì¤‘ì´ë©´ì„œ **ì•„ì§ ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ** trueê°€ ë©ë‹ˆë‹¤.

ê°„ë‹¨íˆ ë§í•´, `isValidating`ì€ ì¬ê²€ì¦ì´ ì§„í–‰ë  ë•Œë§ˆë‹¤ ì´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë° ì‚¬ìš©í•˜ê³ , `isLoading`ì€ SWRì´ ì¬ê²€ì¦ ì¤‘ì´ì§€ë§Œ ì•„ì§ í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ì´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<Callout emoji="ğŸ“">
  í´ë°± ë°ì´í„°ì™€ ì´ì „ ë°ì´í„°ëŠ” "ë¡œë“œëœ ë°ì´í„°"ë¡œ ê°„ì£¼ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ í´ë°± ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ keepPreviousData ì˜µì…˜ì„ í™œì„±í™”í•˜ë©´ í‘œì‹œí•  ë°ì´í„°ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</Callout>

```jsx
function Stock() {
  const { data, isLoading, isValidating } = useSWR(STOCK_API, fetcher, {
    refreshInterval: 3000
  });

  // ì—¬ì „íˆ ì´ˆê¸° ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ì´ë¼ë©´ í‘œì‹œí•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.
  // ì—¬ê¸°ì„œ ìŠ¤ì¼ˆë ˆí†¤ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
  if (isLoading) return <div className="skeleton" />;

  // ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë°ì´í„°ì™€ ë°°ê²½ì„ ë‚˜íƒ€ë‚´ëŠ” ìŠ¤í”¼ë„ˆë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
  // ì¬ê²€ì¦í•©ë‹ˆë‹¤.
  return (
    <>
      <div>${data}</div>
      {isValidating ? <div className="spinner" /> : null}
    </>
  );
}
```

![An example of using the isLoading state](/img/understanding/isloading.gif)

ì½”ë“œ ì˜ˆì œëŠ” [ì—¬ê¸°](https://codesandbox.io/s/swr-isloading-jtopow)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì´ì „ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ì—¬ UX ê°œì„  [#return-previous-data-for-better-ux]

ì…ë ¥ ì‹œ ì‹¤ì‹œê°„ìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê²ƒê³¼ ê°™ì´ ì§€ì†ì ì¸ ì‚¬ìš©ì ë™ì‘ì„ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²½ìš° ì´ì „ì— ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ë©´ UXë¥¼ í¬ê²Œ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `keepPreviousData`ëŠ” í•´ë‹¹ ë™ì‘ì„ í™œì„±í™”í•˜ëŠ” ì˜µì…˜ì…ë‹ˆë‹¤. ë‹¤ìŒì€ ê°„ë‹¨í•œ ê²€ìƒ‰ UIì…ë‹ˆë‹¤:

```jsx
function Search() {
  const [search, setSearch] = React.useState('');

  const { data, isLoading } = useSWR(`/search?q=${search}`, fetcher, {
    keepPreviousData: true
  });

  return (
    <div>
      <input
        type="text"
        value={search}
        onChange={(e) => setSearch(e.target.value)}
        placeholder="Search..."
      />

      <div className={isLoading ? "loading" : ""}>
        {data?.products.map(item => <Product key={item.id} name={item.name} />)
      </div>
    </div>
  );
}
```

`keepPreviousData`ë¥¼ í™œì„±í™”í•˜ë©´ SWR í‚¤ë¥¼ ë³€ê²½í•˜ê³  ìƒˆ í‚¤ì˜ ë°ì´í„°ê°€ ë‹¤ì‹œ ë¡œë”©ë˜ê¸° ì‹œì‘í•˜ë”ë¼ë„ ì´ì „ ë°ì´í„°ë¥¼ ê³„ì† ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<Video
  src="https://user-images.githubusercontent.com/3676859/163695903-a3eb1259-180e-41e0-821e-21c320201194.mp4"
  caption="Keep previous search results when keepPreviousData has been enabled"
  ratio={640/730}
/>

ì´ ì˜ˆì œì˜ ì „ì²´ ì½”ë“œëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: https://codesandbox.io/s/swr-keeppreviousdata-fsjz3m.

## ì„±ëŠ¥ì„ ìœ„í•œ ì˜ì¡´ì„± ìˆ˜ì§‘ [#dependency-collection-for-performance]

SWRì€ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ëœ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë  ë•Œë§Œ ë¦¬ë Œë”ë§ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤. ì¦‰, ì»´í¬ë„ŒíŠ¸ì—ì„œ `data`ë§Œ ì‚¬ìš©í•œë‹¤ë©´, SWRì€ `isValidating`ì´ë‚˜ `isLoading` ê°™ì€ ë‹¤ë¥¸ ì†ì„±ì˜ ë³€ê²½ì„ ë¬´ì‹œí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë Œë”ë§ íšŸìˆ˜ë¥¼ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë” ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](/docs/advanced/performance#dependency-collection)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## onSuccess Callback [#on-success-callback]

Sometimes you may want to run some side effects right after the data is fetched successfully. You can use the `onSuccess` callback option to do that.

```jsx
const { data } = useSWR('/api/user', fetcher, {
  onSuccess: (data, key, config) => {
    // Track successful API calls
    analytics.track('API Success', {
      endpoint: key,
      timestamp: new Date(),
      data: data
    });
  }
});
```

SWR will call the `onSuccess` callback with the fetched data, the key, and the config object. This is useful for analytics, logging, or any other side effects you want to perform after a successful fetch.

### `onSuccess` with deduplication

One of the features of SWR is deduplication, which means that if the same key is being used in multiple places at the same time, SWR will only fetch the data once and share it among those components.

Only the first `onSuccess` callback defined will be called for the first successful fetch, even if `onSuccess` is defined in multiple places.

Example:

```jsx
const FirstComponent = () => {
  const { data } = useSWR('/api/user', fetcher, {
    onSuccess: (data) => {
      // this on success will be called
      console.log('First component success:', data);
    }
  });
  return <div>{data?.name}</div>;
};

const SecondComponent = () => {
  const { data } = useSWR('/api/user', fetcher, {
    onSuccess: (data) => {
      // this on success will NOT be called
      console.log('Second component success:', data);
    }
  });
  return <div>{data?.email}</div>;
};

const App = () => (
  <>
    <FirstComponent />
    <SecondComponent />
  </>
);
```

The example above will only log the success message from the first component when the data is fetched successfully, even though both components have their own `onSuccess` callbacks. This is because SWR deduplicates requests for the same key.

For this reason, you should avoid using `onSuccess` to set local state in the `onSuccess` callback, as it may lead to unexpected behavior when multiple components are using the same key.

Also, the `onSuccess` callback is not called when the data is loaded from the cache, only when it is fetched from the network. If you need to run side effects for cached data, consider using the `useEffect` hook in combination with SWR's data.

```jsx
const { data } = useSWR('/api/user', fetcher);

useEffect(() => {
  if (data) {
    // Run side effects for cached data
    console.log('Cached data:', data);
  }
}, [data]);
```
