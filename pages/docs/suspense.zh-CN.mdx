import { Callout } from 'nextra-theme-docs'

# Suspense

<Callout emoji="ğŸš¨" type="error">
  React ä»ç„¶ä¸å»ºè®®åœ¨ SWR è¿™æ ·çš„æ•°æ®æ¡†æ¶ä¸­ä½¿ç”¨ `Suspense` (<a href="https://reactjs.org/blog/2022/03/29/react-v18.html#suspense-in-data-frameworks" target="_blank" rel="noopener">æ›´å¤šä¿¡æ¯</a>)ã€‚æ ¹æ®æˆ‘ä»¬çš„è°ƒæŸ¥ç»“æœï¼Œè¿™äº› API å°†æ¥å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚
</Callout>

ä½ å¯ä»¥å¯ç”¨ `suspense` é€‰é¡¹ï¼Œä»è€Œè®© SWR å’Œ React Suspense ä¸€èµ·ä½¿ç”¨ï¼š

```jsx
import { Suspense } from 'react'
import useSWR from 'swr'

function Profile () {
  const { data } = useSWR('/api/user', fetcher, { suspense: true })
  return <div>hello, {data.name}</div>
}

function App () {
  return (
    <Suspense fallback={<div>loading...</div>}>
      <Profile/>
    </Suspense>
  )
}
```

<Callout>
  è¯·æ³¨æ„ï¼ŒSWR çš„ `suspense` é€‰é¡¹å¹¶ä¸æ”¯æŒåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å‘ç”Ÿæ”¹å˜ã€‚
</Callout>

åœ¨ Suspense æ¨¡å¼ä¸‹ï¼Œ`data` æ€»æ˜¯è¯·æ±‚å“åº”ï¼ˆå› æ­¤ä½ æ— éœ€æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯ `undefined`ï¼‰ã€‚ä½†å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™éœ€è¦ä½¿ç”¨ [é”™è¯¯è¾¹ç•Œ](https://reactjs.org/docs/concurrent-mode-suspense.html#handling-errors) æ¥æ•è·å®ƒï¼š

```jsx
<ErrorBoundary fallback={<h2>Could not fetch posts.</h2>}>
  <Suspense fallback={<h1>Loading posts...</h1>}>
    <Profile />
  </Suspense>
</ErrorBoundary>
```

<Callout>
Suspense æ¨¡å¼ä¼šåœ¨æ•°æ®å‡†å¤‡å°±ç»ªå‰æš‚åœæ¸²æŸ“ï¼Œè¿™æ„å‘³ç€å®ƒå¾ˆå®¹æ˜“å¯¼è‡´è¯·æ±‚ç€‘å¸ƒé—®é¢˜ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåº”è¯¥åœ¨æ¸²æŸ“ä¹‹å‰é¢„è¯·æ±‚è·å–èµ„æºã€‚[æ›´å¤šä¿¡æ¯](/docs/prefetching)
</Callout>

---

### æ³¨æ„ï¼šä½¿ç”¨æ¡ä»¶è¯·æ±‚ [#note-with-conditional-fetching]

é€šå¸¸ï¼Œå½“å¯ç”¨ `suspense` æ—¶ï¼Œå¯ä»¥ç¡®ä¿ `data` åœ¨æ¸²æŸ“æ—¶å§‹ç»ˆæ˜¯å‡†å¤‡å°±ç»ªçš„ï¼š

```jsx
function Profile () {
  const { data } = useSWR('/api/user', fetcher, { suspense: true })

  // `data` æ°¸è¿œä¸ä¼šæ˜¯ `undefined`
  // ...
}
```

ä½†æ˜¯ï¼Œå½“å®ƒä¸æ¡ä»¶è¯·æ±‚æˆ–ä¾èµ–è¯·æ±‚ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå¦‚æœè¯·æ±‚è¢«**æš‚åœ**ï¼Œ`data` å°†ä¼šæ˜¯ `undefined`ï¼š

```jsx
function Profile () {
  const { data } = useSWR(isReady ? '/api/user' : null, fetcher, { suspense: true })

  // å¦‚æœ `isReady` æ˜¯ falseï¼Œ`data` å°†ä¼šæ˜¯ `undefined`
  // ...
}
```

å¦‚æœä½ æƒ³é˜…è¯»æœ‰å…³è¯¥é™åˆ¶çš„æ›´å¤šæŠ€æœ¯ç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹[è¿™é‡Œçš„è®¨è®º](https://github.com/vercel/swr/pull/357#issuecomment-627089889)ã€‚

### æœåŠ¡ç«¯æ¸²æŸ“ [#server-side-rendering]

å½“åœ¨æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆåŒ…æ‹¬ Next.js ä¸­çš„é¢„æ¸²æŸ“åŠŸèƒ½ï¼‰ä¸­ä½¿ç”¨ suspense æ¨¡å¼æ—¶ï¼Œ**å¿…é¡»**é€šè¿‡ [fallbackData æˆ– fallback](/docs/with-nextjs#pre-rendering-with-default-data) æä¾›åˆå§‹æ•°æ®ï¼Œè¿™æ„å‘³ç€ä½ ä¸èƒ½ä½¿ç”¨ `Suspense` åœ¨æœåŠ¡å™¨ç«¯è·å–æ•°æ®ï¼Œè€Œæ˜¯å®Œå…¨ä½¿ç”¨å®¢æˆ·ç«¯çš„æ•°æ®è¯·æ±‚ï¼Œæˆ–è€…é€šè¿‡æ¡†æ¶çº§çš„æ•°æ®è·å–æ–¹æ³•ï¼ˆä¾‹å¦‚ Next.js ä¸­çš„ getStaticPropsï¼‰è·å–æ•°æ®ï¼Œæ›´å¤šçš„è®¨è®ºå¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/vercel/swr/issues/1906)æ‰¾åˆ°ã€‚