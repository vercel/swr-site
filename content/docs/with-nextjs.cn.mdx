---
title: 'ä¸ Next.js ä¸€åŒä½¿ç”¨'
---

## App Router [#app-dir]

### Server Components [#rsc]

<Callout type="default" emoji="âœ…">
   åœ¨ Next.js App Router ä¸­ï¼Œæ‰€æœ‰çš„ç»„ä»¶éƒ½è¢«é»˜è®¤è§†ä¸º React Server Components (RSC) ã€‚**åœ¨ RSC ä¸­æ‚¨åªèƒ½ ä»SWR å¼•å…¥åºåˆ—åŒ– Key API**
</Callout>

```tsx filename="app/page.tsx" copy
import { unstable_serialize } from 'swr' // âœ… åœ¨ Server components ä¸­å¯ç”¨
import { unstable_serialize as infinite_unstable_serialize } from 'swr/infinite' // âœ… åœ¨ Server components ä¸­å¯ç”¨

import { SWRConfig } from 'swr' // âœ… åœ¨ Server components ä¸­å¯ç”¨
```

<Callout type="error">
   æ‚¨ä¸èƒ½ä» SWR å¼•å…¥ hook API ï¼Œå› ä¸ºå®ƒä»¬åœ¨ RSC ä¸­ä¸å¯ç”¨ã€‚
</Callout>

```tsx filename="app/page.tsx" highlight={1}
import useSWR from 'swr' // âŒ åœ¨ Server components ä¸­ä¸å¯ç”¨
import useSWRInfinite from 'swr/infinite' // âŒ åœ¨ Server components ä¸­ä¸å¯ç”¨
import useSWRMutation from 'swr/mutation' // âŒ åœ¨ Server components ä¸­ä¸å¯ç”¨
```

### Client Components

æ‚¨å¯ä»¥ç›´æ¥ç”¨ `'use client'` æ ‡è®°æ‚¨çš„ç»„ä»¶æˆ–è€…ä» Client Components å¼•å…¥ SWR ï¼Œä¸¤ç§æ–¹æ³•éƒ½å…è®¸æ‚¨ä½¿ç”¨ SWR æä¾›çš„å®¢æˆ·ç«¯æ•°æ®è·å– Hooksã€‚

```tsx filename="app/page.tsx" highlight={1} copy
'use client'

import useSWR from 'swr'

export default function Page() {
  const { data } = useSWR('/api/user', fetcher)
  return <h1>{data.name}</h1>
}
```

### åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­é¢„è·å–æ•°æ®

ç±»ä¼¼äº [å¸¦æœ‰é»˜è®¤æ•°æ®çš„é¢„æ¸²æŸ“](#pre-rendering-with-default-data) æ¨¡å¼ï¼Œä½¿ç”¨ React Server Components (RSC) ä½ å¯ä»¥æ›´è¿›ä¸€æ­¥ã€‚

æ‚¨å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯ __å¯åŠ¨__ æ•°æ®é¢„è·å–ï¼Œå¹¶é€šè¿‡ `<SWRConfig>` provider çš„ `fallback` é€‰é¡¹å°† __promise__ ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶æ ‘:

```tsx filename="app/layout.tsx" copy
import { SWRConfig } from 'swr'

export default async function Layout({ children }: { children: React.ReactNode }) {
  // åœ¨æœåŠ¡å™¨ç«¯å¯åŠ¨æ•°æ®è·å–
  const userPromise = fetchUserFromAPI()
  const postsPromise = fetchPostsFromAPI()

  return (
    <SWRConfig
      value={{
        fallback: {
          // å°† promise ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶
          '/api/user': userPromise,
          '/api/posts': postsPromise,
        },
      }}
    >
      {children}
    </SWRConfig>
  )
}
```

<Callout emoji="ğŸ’¡">
  è¿™ä¸¤ä¸ªæ•°æ®è·å–å‡½æ•°è°ƒç”¨ `fetchUserFromAPI()` å’Œ `fetchPostsFromAPI()` å°†åœ¨æœåŠ¡å™¨ç«¯å¹¶è¡Œæ‰§è¡Œï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä¼šç«‹å³ await å®ƒä»¬ã€‚
</Callout>

åœ¨ React Server Components ä¸­ï¼Œæ‚¨å¯ä»¥è·¨è¶Š `"use client"` è¾¹ç•Œä¼ é€’ promiseï¼ŒSWR å°†åœ¨æœåŠ¡ç«¯æ¸²æŸ“æœŸé—´è‡ªåŠ¨è§£æå®ƒä»¬:

```tsx filename="app/page.tsx" copy
'use client'

import useSWR from 'swr'

export default function Page() {
  // SWR å°†è§£æä»æœåŠ¡å™¨ç»„ä»¶ä¼ é€’çš„ promise
  // åœ¨ SSR å’Œå®¢æˆ·ç«¯ hydration æœŸé—´ï¼Œ'user' å’Œ 'posts' éƒ½å·²å‡†å¤‡å°±ç»ª
  const { data: user } = useSWR('/api/user', fetcher)
  const { data: posts } = useSWR('/api/posts', fetcher)

  return (
    <div>
      <h1>{user.name}'s Posts</h1>
      <ul>
        {posts.map(post => (
          <li key={post.id}>{post.title}</li>
        ))}
      </ul>
    </div>
  )
}
```

ç„¶åï¼Œåœ¨å®¢æˆ·ç«¯ SWR å°†æ¥ç®¡å¹¶ä¿æŒä¸å¹³å¸¸ä¸€æ ·çš„è¡Œä¸ºã€‚

é€šè¿‡å°† promise ä»æœåŠ¡å™¨ç»„ä»¶ä¼ é€’åˆ°å®¢æˆ·ç«¯ç»„ä»¶ï¼Œæ•°æ®è·å–å¯ä»¥å°½å¯èƒ½æ—©åœ°åœ¨æœåŠ¡å™¨ç«¯å¯åŠ¨ã€‚å¹¶ä¸”åªæœ‰å®é™…ä½¿ç”¨æ•°æ®çš„ UI è¾¹ç•Œ(æœ€è¿‘çš„ `Suspense` è¾¹ç•Œæˆ– Next.js layout)æ‰ä¼šåœ¨æµå¼ SSR æœŸé—´è¢«é˜»å¡ã€‚

## å®¢æˆ·ç«¯æ•°æ®è·å– [#client-side-data-fetching]

å¦‚æœæ‚¨çš„é¡µé¢åŒ…å«ä¸€äº›é¢‘ç¹æ›´æ–°çš„æ•°æ®ï¼Œè€Œæ‚¨å¹¶ä¸éœ€è¦é¢„æ¸²æŸ“è¿™äº›æ•°æ®ï¼ŒSWR å°†éå¸¸é€‚ç”¨å¹¶ä¸”å¹¶ä¸éœ€è¦ç‰¹æ®Šçš„é…ç½®ï¼šåªéœ€è¦å¼•å…¥ `useSWR` ç„¶ååœ¨ä»»ä½•éœ€è¦ä½¿ç”¨æ•°æ®çš„ç»„ä»¶ä¸­ä½¿ç”¨è¿™ä¸ª Hook

ä»¥ä¸‹æ˜¯å®ƒçš„å·¥ä½œæ–¹å¼ï¼š

- é¦–å…ˆï¼Œç«‹å³åœ¨æ²¡æœ‰æ•°æ®çš„æƒ…å†µä¸‹å±•ç¤ºé¡µé¢ã€‚æ‚¨å¯ä»¥æ˜¾ç¤ºç¼ºå¤±æ•°æ®çš„åŠ è½½çŠ¶å†µã€‚
- ç„¶åï¼Œåœ¨å®¢æˆ·ç«¯è·å–æ•°æ®ï¼Œå¹¶åœ¨æ•°æ®å‡†å¤‡å¥½æ—¶å±•ç¤ºå®ƒä»¬.

ä¾‹å¦‚ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ç”¨æˆ·ä»ªè¡¨ç›˜é¡µé¢ä¸Šå·¥ä½œå¾—å¾ˆå¥½ã€‚å› ä¸ºä»ªè¡¨æ¿æ˜¯ä¸å…¬å¼€ã€ç”¨æˆ·ç‰¹å®šçš„é¡µé¢ï¼Œä¸ SEO æ— å…³å¹¶ä¸”é¡µé¢ä¸éœ€è¦é¢„æ¸²æŸ“ã€‚æ•°æ®é¢‘ç¹æ›´æ–°ï¼Œéœ€è¦åœ¨è¯·æ±‚æ—¶è·å–ã€‚

## å¸¦æœ‰é»˜è®¤æ•°æ®çš„é¢„æ¸²æŸ“ [#pre-rendering-with-default-data]

å¦‚æœé¡µé¢éœ€è¦é¢„æ¸²æŸ“ï¼ŒNext.js æ”¯æŒ [ä¸¤ç§é¢„æ¸²æŸ“æ–¹å¼](https://nextjs.org/docs/basic-features/data-fetching):
**é™æ€ç”Ÿæˆ (SSG)** and **æœåŠ¡ç«¯æ¸²æŸ“ (SSR)**.

é€šè¿‡ä½¿ç”¨ SWR, æ‚¨å¯ä»¥ä¸ºäº† SEO é¢„æ¸²æŸ“é¡µé¢, å¹¶åŒæ—¶åœ¨å®¢æˆ·ç«¯äº«å—ç¼“å­˜ã€é‡æ–°éªŒè¯ã€ç„¦ç‚¹è¿½è¸ªã€å®šæ—¶é‡æ–°è·å–ç­‰ç‰¹æ€§ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ [`SWRConfig`](/docs/global-configuration) çš„ `fallback` é€‰é¡¹æ¥å°†é¢„è·å–çš„æ•°æ®ä½œä¸ºæ‰€æœ‰ SWR Hook çš„åˆå§‹å€¼ã€‚

ä½¿ç”¨ `getStaticProps` çš„ä¾‹å­ï¼š

```jsx
 export async function getStaticProps () {
  // `getStaticProps` åœ¨æœåŠ¡ç«¯æ‰§è¡Œ
  const article = await getArticleFromAPI()
  return {
    props: {
      fallback: {
        '/api/article': article
      }
    }
  }
}

function Article() {
  // `data` å°†å§‹ç»ˆå¯ç”¨ï¼Œå› ä¸ºå…¶å¤„äº `fallback` åˆ—è¡¨ä¸­
  const { data } = useSWR('/api/article', fetcher)
  return <h1>{data.title}</h1>
}

export default function Page({ fallback }) {
  // åœ¨ `SWRConfig` æ ‡ç­¾å†…çš„ SWR hooks å°†ä½¿ç”¨è¿™äº›å€¼
  return (
    <SWRConfig value={{ fallback }}>
      <Article />
    </SWRConfig>
  )
}
```

è¯¥é¡µé¢ä»ç„¶æ˜¯é¢„å…ˆç”Ÿæˆï¼ŒSEO å‹å¥½çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¿«é€Ÿååº”ã€‚ç„¶è€Œè¯¥é¡µé¢åœ¨å®¢æˆ·ç«¯ä¾§ä»ç„¶å®Œå…¨ç”± SWR é©±åŠ¨ã€‚æ•°æ®ä»ç„¶æ˜¯åŠ¨æ€çš„ï¼Œä¸”å¯ä»¥è‡ªåŠ¨æ›´æ–°ã€‚

<Callout emoji="ğŸ’¡">
  `Article` ç»„ä»¶å°†å…ˆæ¸²æŸ“é¢„å…ˆç”Ÿæˆçš„æ•°æ®ï¼Œå¹¶ä¸”åœ¨é¡µé¢æ°´åˆå®Œæˆåå°†å†æ¬¡è·å–æœ€æ–°æ•°æ®ä»¥ä¿æŒæ•°æ®æœ€æ–°
</Callout>

### å¤æ‚å…³é”®å­— [#complex-keys]

`useSWR` å¯ä»¥ä¸ `array` å’Œ `function` ç±»å‹çš„ key ä¸€åŒä½¿ç”¨. è‹¥è¦é€šè¿‡è¿™äº›ç±»å‹çš„ key ä½¿ç”¨é¢„å…ˆè·å–çš„æ•°æ®ï¼Œéœ€è¦ç”¨ `unstable_serialize` åºåˆ—åŒ– `fallback` key.

```jsx
import useSWR, { unstable_serialize } from 'swr'

export async function getStaticProps () {
  const article = await getArticleFromAPI(1)
  return {
    props: {
      fallback: {
        // unstable_serialize() array style key
        [unstable_serialize(['api', 'article', 1])]: article,
      }
    }
  }
}

function Article() {
  // using an array style key.
  const { data } = useSWR(['api', 'article', 1], fetcher)
  return <h1>{data.title}</h1>
}

export default function Page({ fallback }) {
  return (
    <SWRConfig value={{ fallback }}>
      <Article />
    </SWRConfig>
  )
}
```
